
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JS-Digital Admin</title>
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg-dark: #080808;
            --bg-panel: #141414;
            --primary: #bc13fe;
            --text-main: #ffffff;
            --border: 1px solid #333;
        }

        * { box-sizing: border-box; }
        body { margin: 0; font-family: 'Outfit', sans-serif; background: var(--bg-dark); color: var(--text-main); display: flex; height: 100vh; overflow: hidden; }

        /* Login Overlay */
        #auth-overlay {
            position: fixed; inset: 0; background: #000; z-index: 999;
            display: flex; align-items: center; justify-content: center;
        }
        .login-card {
            background: var(--bg-panel); padding: 40px; width: 350px; border-radius: 12px;
            border: 1px solid var(--primary); text-align: center;
        }

        /* Sidebar */
        aside {
            width: 250px; background: var(--bg-panel); border-right: var(--border);
            display: flex; flex-direction: column; padding: 20px;
        }
        .logo { color: var(--primary); font-size: 1.5rem; font-weight: bold; margin-bottom: 40px; }
        .nav-link {
            padding: 12px; color: #888; cursor: pointer; display: flex; align-items: center; gap: 10px;
            border-radius: 6px; margin-bottom: 5px; transition: 0.2s;
        }
        .nav-link:hover, .nav-link.active { background: rgba(188, 19, 254, 0.1); color: #fff; }

        /* Main */
        main { flex: 1; padding: 30px; overflow-y: auto; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        
        /* Forms */
        .form-group { margin-bottom: 15px; text-align: left; }
        .form-label { display: block; margin-bottom: 5px; color: #aaa; font-size: 0.9rem; }
        .form-input {
            width: 100%; background: #000; border: var(--border); padding: 10px;
            color: #fff; border-radius: 6px; outline: none;
        }
        .btn {
            background: var(--primary); color: #fff; border: none; padding: 10px 20px;
            border-radius: 6px; cursor: pointer; font-weight: 600; width: 100%;
        }
        .btn-sm { width: auto; }

        /* File Upload */
        .drop-zone {
            border: 2px dashed #444; padding: 30px; text-align: center; border-radius: 8px;
            cursor: pointer; transition: 0.2s; position: relative;
        }
        .drop-zone:hover { border-color: var(--primary); background: rgba(188, 19, 254, 0.05); }
        .file-input { position: absolute; inset: 0; opacity: 0; cursor: pointer; }
        .preview-img { max-width: 100%; max-height: 150px; margin-top: 10px; display: none; border-radius: 6px; }

        /* Tables */
        table { width: 100%; border-collapse: collapse; background: var(--bg-panel); border-radius: 8px; overflow: hidden; }
        th, td { padding: 15px; text-align: left; border-bottom: var(--border); }
        th { background: #1a1a1a; font-weight: 600; color: #aaa; }
        
        /* Utilities */
        .hidden { display: none !important; }
        .toast {
            position: fixed; top: 20px; right: 20px; background: #222; padding: 15px 25px;
            border-radius: 8px; border-left: 4px solid var(--primary); box-shadow: 0 5px 15px #000;
            transform: translateX(120%); transition: 0.3s; z-index: 1000;
        }
        .toast.show { transform: translateX(0); }
    </style>
</head>
<body>

    <!-- Login -->
    <div id="auth-overlay">
        <div class="login-card">
            <h2 class="logo" style="margin-bottom: 20px;">JS ADMIN</h2>
            <form onsubmit="admin.login(event)">
                <div class="form-group"><input type="text" id="aUser" class="form-input" placeholder="Username"></div>
                <div class="form-group"><input type="password" id="aPass" class="form-input" placeholder="Password"></div>
                <div class="form-group"><input type="password" id="aCode" class="form-input" placeholder="Secret Code"></div>
                <button type="submit" class="btn">ACCESS PANEL</button>
            </form>
            <p id="loginMsg" style="color: red; margin-top: 10px; font-size: 0.8rem;"></p>
        </div>
    </div>

    <!-- Layout -->
    <aside>
        <div class="logo">JS-DIGITAL</div>
        <nav>
            <div class="nav-link active" onclick="admin.nav('products')"><i class="fas fa-box"></i> Products</div>
            <div class="nav-link" onclick="admin.nav('settings')"><i class="fas fa-cogs"></i> Settings</div>
        </nav>
        <button class="btn" style="margin-top: auto; background: red;" onclick="location.reload()">LOCK</button>
    </aside>

    <main>
        <!-- Products View -->
        <div id="view-products">
            <div class="header">
                <h2>Product Management</h2>
            </div>

            <!-- Add Product Form -->
            <div style="background: var(--bg-panel); padding: 20px; border-radius: 12px; margin-bottom: 30px;">
                <h3 style="margin-top: 0;">Add New Product</h3>
                <form onsubmit="admin.addProduct(event)">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div>
                            <div class="form-group">
                                <label class="form-label">Title</label>
                                <input type="text" id="pTitle" class="form-input" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Price (₹)</label>
                                <input type="number" id="pPrice" class="form-input" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Demo URL (Optional)</label>
                                <input type="url" id="pDemo" class="form-input" placeholder="https://...">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Description</label>
                                <textarea id="pDesc" class="form-input" rows="3"></textarea>
                            </div>
                        </div>
                        <div>
                            <div class="form-group">
                                <label class="form-label">Product Image</label>
                                <div class="drop-zone" id="dropZone">
                                    <i class="fas fa-cloud-upload-alt" style="font-size: 2rem; color: #666;"></i>
                                    <p style="margin: 10px 0; color: #888;">Drag & Drop or Click</p>
                                    <input type="file" id="pFile" class="file-input" accept="image/*" required>
                                    <img id="imgPreview" class="preview-img">
                                </div>
                                <p id="uploadStatus" style="font-size: 0.8rem; color: var(--primary); display:none;">Ready to upload...</p>
                            </div>
                            <button type="submit" class="btn" id="saveBtn">Save Product</button>
                        </div>
                    </div>
                </form>
            </div>

            <!-- List -->
            <table>
                <thead><tr><th>Image</th><th>Title</th><th>Price</th><th>Action</th></tr></thead>
                <tbody id="productList"></tbody>
            </table>
        </div>

        <!-- Settings View -->
        <div id="view-settings" class="hidden">
            <div class="header"><h2>Global Settings</h2></div>
            <div style="background: var(--bg-panel); padding: 20px; border-radius: 12px; max-width: 500px;">
                <div class="form-group">
                    <label class="form-label">Site Name (Dynamic Branding)</label>
                    <input type="text" id="sName" class="form-input">
                </div>
                <button class="btn" onclick="admin.saveSettings()">Update Site</button>
            </div>
        </div>
    </main>

    <div id="toast" class="toast">Action Successful</div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, setDoc, getDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCkndE5h7HOLTg2xEs7mgKimJIwodApFJs",
            authDomain: "andronix-bcdf7.firebaseapp.com",
            projectId: "andronix-bcdf7",
            storageBucket: "andronix-bcdf7.appspot.com",
            messagingSenderId: "982083836381",
            appId: "1:982083836381:web:88a162ce883e69d2e73e34"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const storage = getStorage(app);

        // --- Image Preview Logic ---
        document.getElementById('pFile').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if(file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = document.getElementById('imgPreview');
                    img.src = e.target.result;
                    img.style.display = 'block';
                }
                reader.readAsDataURL(file);
            }
        });

        window.admin = {
            login: async (e) => {
                e.preventDefault();
                const u = document.getElementById('aUser').value.trim();
                const p = document.getElementById('aPass').value.trim();
                const c = document.getElementById('aCode').value.trim();
                
                if(u === 'josimsekh31' && p === 'josimsv1' && c === '191355') {
                    try {
                        await signInAnonymously(auth);
                        document.getElementById('auth-overlay').classList.add('hidden');
                        admin.loadProducts();
                        admin.showToast("Welcome Admin");
                    } catch(err) {
                        alert("Firebase Auth Error: Enable Anonymous Auth in Console");
                    }
                } else {
                    document.getElementById('loginMsg').textContent = "Invalid Credentials!";
                }
            },

            nav: (view) => {
                document.getElementById('view-products').classList.add('hidden');
                document.getElementById('view-settings').classList.add('hidden');
                document.getElementById('view-'+view).classList.remove('hidden');
                
                document.querySelectorAll('.nav-link').forEach(el => el.classList.remove('active'));
                event.currentTarget.classList.add('active');

                if(view === 'settings') admin.loadSettings();
            },

            addProduct: async (e) => {
                e.preventDefault();
                const btn = document.getElementById('saveBtn');
                const status = document.getElementById('uploadStatus');
                const fileInput = document.getElementById('pFile');
                
                if(fileInput.files.length === 0) return alert("Please select an image");

                btn.disabled = true;
                btn.textContent = "Uploading...";
                status.style.display = 'block';

                try {
                    const file = fileInput.files[0];
                    const storageRef = ref(storage, 'products/' + Date.now() + '_' + file.name);
                    
                    // 1. Upload Image
                    status.textContent = "Uploading to Firebase Storage...";
                    const snapshot = await uploadBytes(storageRef, file);
                    const downloadURL = await getDownloadURL(snapshot.ref);

                    // 2. Save Data
                    status.textContent = "Saving to Database...";
                    await addDoc(collection(db, "products"), {
                        title: document.getElementById('pTitle').value,
                        price: Number(document.getElementById('pPrice').value),
                        demoUrl: document.getElementById('pDemo').value,
                        description: document.getElementById('pDesc').value,
                        imageUrl: downloadURL,
                        visible: true,
                        createdAt: new Date()
                    });

                    admin.showToast("Product Added Successfully!");
                    e.target.reset();
                    document.getElementById('imgPreview').style.display = 'none';
                    admin.loadProducts();

                } catch(err) {
                    console.error(err);
                    alert("Failed: " + err.message + "\n(Did you enable Firebase Storage?)");
                } finally {
                    btn.disabled = false;
                    btn.textContent = "Save Product";
                    status.style.display = 'none';
                }
            },

            loadProducts: async () => {
                const list = document.getElementById('productList');
                list.innerHTML = '<tr><td colspan="4">Loading...</td></tr>';
                const snap = await getDocs(collection(db, "products"));
                list.innerHTML = '';
                snap.forEach(doc => {
                    const p = doc.data();
                    const row = `<tr>
                        <td><img src="${p.imageUrl}" style="width:50px; height:50px; object-fit:cover; border-radius:4px;"></td>
                        <td>${p.title}</td>
                        <td>₹${p.price}</td>
                        <td><button class="btn btn-sm" style="background:red;" onclick="admin.deleteProduct('${doc.id}')"><i class="fas fa-trash"></i></button></td>
                    </tr>`;
                    list.innerHTML += row;
                });
            },

            deleteProduct: async (id) => {
                if(confirm("Delete this product?")) {
                    await deleteDoc(doc(db, "products", id));
                    admin.loadProducts();
                    admin.showToast("Product Deleted");
                }
            },

            saveSettings: async () => {
                const name = document.getElementById('sName').value;
                await setDoc(doc(db, "siteSettings", "config"), { siteName: name }, { merge: true });
                admin.showToast("Site Name Updated!");
            },

            loadSettings: async () => {
                const docSnap = await getDoc(doc(db, "siteSettings", "config"));
                if(docSnap.exists()) {
                    document.getElementById('sName').value = docSnap.data().siteName || '';
                }
            },

            showToast: (msg) => {
                const t = document.getElementById('toast');
                t.textContent = msg;
                t.classList.add('show');
                setTimeout(() => t.classList.remove('show'), 3000);
            }
        };
    </script>
</body>
</html>

